<script type="text/javascript" src="<TMPL_VAR NAME=base_url>/Caliban.js"> >    
</script>

<script type="text/javascript">
function OnSubmitForm() {
    var login = document.home.login.value;
    var pass = document.home.password.value;
    document.body.style.cursor = "wait";
    document.home.jgi_sso.style.cursor = "wait";
    
    //alert(login);
    
    if(isBlank(login)) {
        document.body.style.cursor = "default";
        document.home.jgi_sso.style.cursor = "default";
        alert('Login cannot be blank');
        return false;
    }

    if(isBlank(pass)) {
        document.body.style.cursor = "default";
        document.home.jgi_sso.style.cursor = "default";
        alert('Password cannot be blank');
        return false;
    }
/*    
    if(document.getElementById("forceimg").checked) {
        alert('IMG only login');
        document.home.oldLogin.value = 'true';
        document.home.action = "<TMPL_VAR NAME=cgi_url>/main.cgi";        
        return true;
    }
*/    
    var request = new XMLHttpRequest();  
    // https://developer.mozilla.org/En/XMLHttpRequest/Using_XMLHttpRequest

    request.open('GET', '<TMPL_VAR NAME=cgi_url>/IsCalibanUser.cgi?login=' + login, false);
    
    try {   
        request.send(null);
    } catch (e) {
        document.body.style.cursor = "default";
        document.home.jgi_sso.style.cursor = "default";
        alert("You trying to enter a secure site with http. For security please update your URL to use https.");
        return false;
    }  

    var text = request.responseText;
    text = chomp(text);
    if (request.status === 200) {  
        if(text == 'jgi') {
            document.home.oldLogin.value = 'false';
            document.home.action = "<TMPL_VAR NAME=sso_url>/signon/create";
            return true;
        } else if(text == 'img') {
            document.home.oldLogin.value = 'true';
            document.home.action = "<TMPL_VAR NAME=cgi_url>/main.cgi";
            return true;
        } else if(text.match(/^Error/) ) {
            alert(text);
        } else {
            setTimeout(function () {alert("login/password does not match");}, 2000);
        }
    }  else {
        setTimeout(function () {alert("failed: JGI SSO access issues " + request.status);}, 2000);
    }
    document.body.style.cursor = "default";
    document.home.jgi_sso.style.cursor = "default";
    return false;
}
</script>


<h3>IMG Login</h3>
<p>
    <a href='https://groups.google.com/a/lbl.gov/d/msg/img-user-forum/9SanvbC2pAk/Sq-bd6n4HksJ'><b>Why do I need an
            account?</b> </a><br> For accessing IMG all users need to have an <b>IMG Account</b> which can be obtained via <a
        href='https://img.jgi.doe.gov/request'>Request Account</a>. <br /> Users with JGI SSO accounts are encouraged to get
    an IMG Account as well. <a href="https://groups.google.com/a/lbl.gov/d/msg/img-user-forum/A8AzVLe-bC4/wwrddBd20xYJ"><b>Help?</b>
    </a> <br /> <a href='<TMPL_VAR NAME=base_url>/doc/systemreqs.html'><b>IMG System Requirements</b> </a>
</p>


<form id="home" name="home" enctype="multipart/form-data" method="post" onsubmit="return OnSubmitForm()">

    <input type='hidden' name='oldLogin' value='false' /> <input type="hidden" name='redirect' value='' />

<table border='0'>
    <tr>
    <td style="vertical-align: top;">
        JGI SSO Email or IMG Account Username: 
        <br> <input id="login" name="login" type="text" size='40' />
        <br>
        Password: 
        <br> <input id="password" name="password" type="password" size='40' />
        <br> Sign in 
        <br> <input class="smdefbutton" type="submit" name="jgi_sso" value="Login"
            title='Sign in with JGI Single Sign On Account or IMG Account' />
     </td>
     <td style="vertical-align: top;padding-left: 75px;">
        <b>Forgot your password? </b> <br> <a href='forgot.cgi'
            onClick="_gaq.push(['_trackEvent', 'Password', 'IMG Account', 'reset']);"> Reset IMG Account Password</a>
        &nbsp;&nbsp; or &nbsp;&nbsp; <a href='https://signon.jgi.doe.gov/password_resets'
            onClick="_gaq.push(['_trackEvent', 'Password', 'JGI SSO', 'reset']);"> Reset JGI SSO Account Password</a> <br>
        <a href="https://groups.google.com/a/lbl.gov/forum/#!msg/img-user-forum/A8AzVLe-bC4/iDIBY983pvIJ"><b>Help?</b>
        </a>
        <br><br>
        <i>The follow two links should be used if you are having trouble logging into IMG.</i>
        <br>
        Old <a href='main.cgi?imgOnlyLogin=yes' 
            title='ONLY to be used if you know that you are using an IMG account!'> 
            IMG Account Login</a> page 
            or the
            <a href='https://signon.jgi.doe.gov/'>JGI SSO login page</a>
     </td>
    </tr>
</table>
</form>

<script language='JavaScript' type="text/javascript">
            document.home.login.focus();
</script>
        